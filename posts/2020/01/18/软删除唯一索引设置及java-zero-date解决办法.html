<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>软删除唯一索引设置及 Java Zero Date 解决办法 | 鸽呜咕的博客</title>
    <meta name="description" content="总会鸽呜咕的博客">
    <meta name="generator" content="VuePress 1.3.0">
    <meta property="article:published_time" content="Sat Jan 18 2020 08:00:00 GMT+0800 (中国标准时间)"><meta property="article:modified_time" content="Sat Jan 18 2020 22:22:06 GMT+0800 (中国标准时间)"><meta property="og:site_name" content="鸽呜咕的博客"><meta property="og:title" content="软删除唯一索引设置及 Java Zero Date 解决办法"><meta property="og:type" content="website"><meta property="og:url" content="/posts/2020/01/18/%E8%BD%AF%E5%88%A0%E9%99%A4%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE%E5%8F%8Ajava-zero-date%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95.html"><meta name="twitter:title" content="软删除唯一索引设置及 Java Zero Date 解决办法"><meta name="twitter:url" content="/posts/2020/01/18/%E8%BD%AF%E5%88%A0%E9%99%A4%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE%E5%8F%8Ajava-zero-date%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95.html"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:label2" content="Filed under"><meta name="twitter:data2" content="DataBase, Java, Spring"><meta property="article:tag" content="DataBase"><meta property="article:tag" content="Java"><meta property="article:tag" content="Spring">
    <link rel="preload" href="/assets/js/vendor.vue.a0164783.js" as="script"><link rel="preload" href="/assets/css/0.styles.d777db81.css" as="style"><link rel="preload" href="/assets/js/vendor.commons.d777db81.js" as="script"><link rel="preload" href="/assets/css/styles.eba4ba0f.css" as="style"><link rel="preload" href="/assets/js/app.eba4ba0f.js" as="script"><link rel="preload" href="/assets/css/5.styles.6db3e396.css" as="style"><link rel="preload" href="/assets/js/5.6db3e396.js" as="script"><link rel="preload" href="/assets/js/31.611a8ff3.js" as="script"><link rel="prefetch" href="/assets/css/1.styles.b2c0bf60.css"><link rel="prefetch" href="/assets/css/4.styles.abd55d40.css"><link rel="prefetch" href="/assets/css/6.styles.adf54e21.css"><link rel="prefetch" href="/assets/css/7.styles.59e1b331.css"><link rel="prefetch" href="/assets/css/8.styles.e7ff88b8.css"><link rel="prefetch" href="/assets/js/1.b2c0bf60.js"><link rel="prefetch" href="/assets/js/10.cd53a94b.js"><link rel="prefetch" href="/assets/js/11.bb106957.js"><link rel="prefetch" href="/assets/js/12.af9867e3.js"><link rel="prefetch" href="/assets/js/13.b14f53f1.js"><link rel="prefetch" href="/assets/js/14.9a301c2f.js"><link rel="prefetch" href="/assets/js/15.d2ccc90d.js"><link rel="prefetch" href="/assets/js/16.f7966c21.js"><link rel="prefetch" href="/assets/js/17.cd9bc917.js"><link rel="prefetch" href="/assets/js/18.0a734a0d.js"><link rel="prefetch" href="/assets/js/19.f782d789.js"><link rel="prefetch" href="/assets/js/20.e69b1d76.js"><link rel="prefetch" href="/assets/js/21.2ffdbc56.js"><link rel="prefetch" href="/assets/js/22.5b0c2c7a.js"><link rel="prefetch" href="/assets/js/23.9036a32d.js"><link rel="prefetch" href="/assets/js/24.89940a5d.js"><link rel="prefetch" href="/assets/js/25.f1d25d80.js"><link rel="prefetch" href="/assets/js/26.85cdd63c.js"><link rel="prefetch" href="/assets/js/27.76894133.js"><link rel="prefetch" href="/assets/js/28.2e180cdf.js"><link rel="prefetch" href="/assets/js/29.fc5d0e32.js"><link rel="prefetch" href="/assets/js/30.e664a78b.js"><link rel="prefetch" href="/assets/js/4.abd55d40.js"><link rel="prefetch" href="/assets/js/6.adf54e21.js"><link rel="prefetch" href="/assets/js/7.59e1b331.js"><link rel="prefetch" href="/assets/js/8.e7ff88b8.js"><link rel="prefetch" href="/assets/js/9.b62280a7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d777db81.css"><link rel="stylesheet" href="/assets/css/styles.eba4ba0f.css"><link rel="stylesheet" href="/assets/css/5.styles.6db3e396.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" data-v-3f78c2c8><div data-v-5e061783 data-v-3f78c2c8><nav class="navbar" data-v-5e061783><div class="container" data-v-5e061783><a href="/" class="router-link-active" data-v-5e061783><span class="navbar-site-name" data-v-5e061783>
          鸽呜咕的博客
        </span></a> <div class="navbar-toggler" data-v-5e061783><svg class="icon" style="font-size:1.2em;" data-v-5e061783 data-v-5e061783><title data-v-5e061783 data-v-5e061783>menu</title><use xlink:href="#icon-menu" data-v-5e061783 data-v-5e061783></use></svg></div> <div class="navbar-links" data-v-5e061783><div class="search-box custom-search" data-v-5e061783><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="/" class="navbar-link" data-v-5e061783>
            主页
          </a><a href="/posts/" class="navbar-link" data-v-5e061783>
            文章
          </a><a href="/posts/categories/" class="navbar-link" data-v-5e061783>
            分类
          </a><a href="/posts/tags/" class="navbar-link" data-v-5e061783>
            标签
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-5e061783></div></div> <div class="banner" data-v-66d98992 data-v-3f78c2c8 data-v-3f78c2c8><div class="container" data-v-66d98992><div class="center" data-v-66d98992><h1 data-v-66d98992 data-v-3f78c2c8>
          软删除唯一索引设置及 Java Zero Date 解决办法
        </h1> <section class="post-date clearfix" data-v-66d98992 data-v-3f78c2c8><p class="post-info" data-v-66d98992 data-v-3f78c2c8><span id="/posts/2020/01/18/%E8%BD%AF%E5%88%A0%E9%99%A4%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE%E5%8F%8Ajava-zero-date%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95.html" data-flag-title="软删除唯一索引设置及 Java Zero Date 解决办法" class="leancloud_visitors" data-v-66d98992 data-v-3f78c2c8>
              阅读数:
              <i class="leancloud-visitors-count" data-v-66d98992 data-v-3f78c2c8>999+</i>次
            </span> <span data-v-66d98992 data-v-3f78c2c8>
              字数统计 : 1372
            </span> <span data-v-66d98992 data-v-3f78c2c8>
              阅读时间 ≈ 3.4 分钟
            </span></p> <span class="create-date" data-v-66d98992 data-v-3f78c2c8>
            发布时间 : 2020-01-18
          </span></section></div></div></div></header> <div class="container clearfix show-aside" data-v-096a6383 data-v-096a6383><aside class="aside" data-v-096a6383><div class="info-card main-div" data-v-e875420e data-v-096a6383><div class="info-card-header" data-v-e875420e><a href="/" class="router-link-active" data-v-e875420e><img src="https://oss.kkyan.cn/20190314165028.gif" alt="kky" class="info-avatar" data-v-e875420e></a></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-096a6383><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/posts/2020/01/18/%E8%BD%AF%E5%88%A0%E9%99%A4%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE%E5%8F%8Ajava-zero-date%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95.html#唯一索引为什么会失效">唯一索引为什么会失效</a></li><li><a href="/posts/2020/01/18/%E8%BD%AF%E5%88%A0%E9%99%A4%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE%E5%8F%8Ajava-zero-date%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95.html#为逻辑删除字段添加联合索引">为逻辑删除字段添加联合索引</a></li><li><a href="/posts/2020/01/18/%E8%BD%AF%E5%88%A0%E9%99%A4%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE%E5%8F%8Ajava-zero-date%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95.html#timestamp-0值设置与mysql严格模式">Timestamp 0值设置与MySQL严格模式</a></li><li><a href="/posts/2020/01/18/%E8%BD%AF%E5%88%A0%E9%99%A4%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE%E5%8F%8Ajava-zero-date%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95.html#java-localdatetime-0值转换">JAVA LocalDateTime 0值转换</a></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2020/01/18/%E8%BD%AF%E5%88%A0%E9%99%A4%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE%E5%8F%8Ajava-zero-date%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95.html#vcomments">
      评论
    </a></div></div></aside> <main class="main" data-v-096a6383><div class="post" data-v-096a6383 data-v-096a6383><article class="main-div"><div class="post-content content content__default"><p>数据是无价的，当我们删除数据时，多数情况下我们会采用设置数据不可见的方法来替代真正意义上的物理删除，这种删除方法就叫做“软删除”。软删除可以保留数据的历史记录，便于今后数据分析以及一些故障情况下的恢复，但软删除也随之带来一些问题：数据表唯一索引失效。</p> <h2 id="唯一索引为什么会失效"><a href="#唯一索引为什么会失效" class="header-anchor">#</a> 唯一索引为什么会失效</h2> <p>很好理解，当我们使用软删除方法时，实际上是将删除<code>delete from table</code> 变为了 <code>update table</code>，虽然对外来说数据变为不可见了，但是数据库中的数据仍然保留，当插入同样的数据情况下，唯一索引就会发生冲突。</p> <h2 id="为逻辑删除字段添加联合索引"><a href="#为逻辑删除字段添加联合索引" class="header-anchor">#</a> 为逻辑删除字段添加联合索引</h2> <p>解决软删除索引问题的其中一个办法是用业务逻辑来保证数据的合法性，但是那样要大规模的修改插入逻辑，对系统影响较大。</p> <p>另一个办法就是为我们的唯一字段和逻辑删除字段创建联合索引，这样就要求逻辑删除字段必须是一个动态值，可以是一个token、timestamp或是其他符合自己业务的值。</p> <div class="tip custom-block"><p class="custom-block-title">为什么逻辑删除字段是一个动态值？</p> <p>考虑以下数据库</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> test{
	<span class="token punctuation">`</span>username<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>deleted<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">,</span>	<span class="token comment">/* 1代表删除 */</span>
	<span class="token keyword">unique</span> <span class="token keyword">key</span> <span class="token punctuation">`</span><span class="token keyword">unique</span><span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>deleted_at<span class="token punctuation">`</span><span class="token punctuation">)</span> 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>执行以下语句</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 此时插入一条数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 再次插入相同数据，会因为 (test1-0) 存在禁止插入</span>
<span class="token keyword">update</span> test <span class="token keyword">set</span> deleted <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 逻辑删除刚才插入的数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 再次插入相同的数据，由于是联合索引，不存在 (test1-0)，插入是成功的</span>
<span class="token keyword">update</span> test <span class="token keyword">set</span> deleted <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// ！注意此时删除会报错，因为已经存在了 (test1-1) 的索引</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>可以看出，当只用一个固定值来代表逻辑删除状态时，联合索引会产生冲突，删除失败</p></div> <p><strong>有一个需要注意的坑是，MySQL中的联合索引是不能包含 <code>NULL</code>值的</strong>。例如:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> test{
	<span class="token punctuation">`</span>username<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>deleted_at<span class="token punctuation">`</span> <span class="token keyword">timestamp</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
	<span class="token keyword">unique</span> <span class="token keyword">key</span> <span class="token punctuation">`</span><span class="token keyword">unique</span><span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>deleted_at<span class="token punctuation">`</span><span class="token punctuation">)</span> 
}
<span class="token comment">/* deleted_at 值默认是null */</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">## 多次插入是成功的，因为 null 不能做为索引</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在MySQL的官方文档对唯一索引的描述是<a href="https://dev.mysql.com/doc/refman/8.0/en/create-index.html#create-index-unique" target="_blank" rel="noopener noreferrer">这样<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的：</p> <div class="tip custom-block"><p class="custom-block-title">UNIQUE</p> <p>A <code>UNIQUE</code> index creates a constraint such that all values in the index must be distinct. An error occurs if you try to add a new row with a key value that matches an existing row. If you specify a prefix value for a column in a <code>UNIQUE</code> index, the column values must be unique within the prefix length. A <code>UNIQUE</code> index permits multiple <code>NULL</code> values for columns that can contain <code>NULL</code>.</p></div> <p>描述的最后写着，唯一索引会允许多个 NULL 值的添加。</p> <p><strong>因此当我们将逻辑删除字段加入唯一索引时，我们需要为其指定一个<code>0值</code>代表未删除的数据，而不能简单的使用<code>NULL</code>代替。</strong></p> <h2 id="timestamp-0值设置与mysql严格模式"><a href="#timestamp-0值设置与mysql严格模式" class="header-anchor">#</a> Timestamp 0值设置与MySQL严格模式</h2> <p>一般情况下，我们会将逻辑删除字段设置为 timestamp 类型，当发生删除时，直接将字段设置为当前时间，这样既能实现删除字段值的动态变化，也能记录数据删除的时间，便于进行其他数据检索工作。</p> <p>前面我们提到，逻辑删除字段需要指定一个0值，timestamp也有默认的0值。</p> <p>timestamp 规定的数据大小是从<code>1970-01-01 00:00:01.000000</code> 到 <code>2038-01-19 03:14:07.999999</code>。其他任何不符合这个时间段的数据都会被变换为<code>0</code>插入到数据库中，这个数据在数据库中的表现为<code>0000-00-00 00:00:00</code>。</p> <p><strong>MySQL默认是禁止进行以上的转换的</strong>，如果直接部署一个MySQL服务并建立默认为0值的timestamp字段，或是插入一个0值的timestamp类型数据都会出错，这种模式被称为 MySQL 严格模式 (strict mode)。</p> <p>默认的MySQL包含了6种模式（以MySQL 8.0 为准）：</p> <table><thead><tr><th>名称</th> <th style="text-align:left;">意义</th></tr></thead> <tbody><tr><td>ONLY_FULL_GROUP_BY</td> <td style="text-align:left;">对于 GROUP BY操作，如果在 SELECT 中的列没有出现在GROUP BY中出现，则拒绝</td></tr> <tr><td>STRICT_TRANS_TABLE</td> <td style="text-align:left;">如果操作中的值不能插入事务表，则拒绝该操作</td></tr> <tr><td>NO_ZERO_IN_DATE</td> <td style="text-align:left;">不允许日期和月份为0</td></tr> <tr><td>NO_ZERO_DATE</td> <td style="text-align:left;">不允许插入0日期</td></tr> <tr><td>ERROR_FOR_DIVISION_BY_ZERO</td> <td style="text-align:left;">如果数据被0除，则报错</td></tr> <tr><td>NO_ENGINE_SUBTITUTION</td> <td style="text-align:left;">如果储存引擎被禁用或未编译，则报错</td></tr></tbody></table> <p>我们可以通过以下命令查看当前SQL模式:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> @<span class="token variable">@GLOBAL.sql_mode</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> @<span class="token variable">@SESSION.sql_mode</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改MySQL模式有两种方式:</p> <ol><li><p>修改 my.cnf 文件，在<code>[mysqld]</code>下加入：</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token selector">[mysqld]</span>
<span class="token comment">#set the SQL mode to strict</span>
<span class="token comment">#sql-mode=&quot;modes...&quot; </span>
<span class="token constant">sql-mode</span> <span class="token attr-value"><span class="token punctuation">=</span> &quot;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>使用 sql 语句修改 server:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> sql_mode <span class="token operator">=</span> <span class="token string">'modes...'</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token keyword">SESSION</span> sql_mode <span class="token operator">=</span> <span class="token string">'modes...'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <h2 id="java-localdatetime-0值转换"><a href="#java-localdatetime-0值转换" class="header-anchor">#</a> JAVA LocalDateTime 0值转换</h2> <p>当我们修改完数据库实现0值插入后，还需要对Java做一定的修改。</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> deletedAt<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当我们直接进行数据映射时会发生以下错误</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>com.mysql.cj.exceptions.DataReadException: Zero date value prohibited
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们需要在mysql连接时添加<code>zeroDateTimeBehavior=convertToNull</code>，告知驱动对0值的处理方法，以 Spring 为例：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">spring.datasource.druid.url</span> <span class="token punctuation">=</span> <span class="token attr-value">jdbc:mysql://localhost:3306/test?zeroDateTimeBehavior=convertToNull</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></article> <section class="post-meta main-div" data-v-5e90143d><section class="post-links" data-v-5e90143d><a href="/posts/2019/12/04/springboot-init.html" class="post-link" data-v-5e90143d>
      上一篇 : Spring Boot学习笔记 - 初始化及启动原理
    </a> <a href="/posts/2020/02/09/%E7%AE%80%E5%8D%95%E5%8A%A8%E6%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2.html" class="post-link" data-v-5e90143d>
      下一篇 : Redis源码学习1-SDS简单动态字符串
    </a></section></section> <section class="main-div"><div class="vcomment"><div id="vcomments"></div></div></section></div></main></div> <footer class="footer" data-v-4e0ced49><p class="footer-text" data-v-4e0ced49><span data-v-4e0ced49>Powered by </span> <a href="https://github.com/vuejs/vuepress" target="_blank" data-v-4e0ced49>
      VuePress
    </a> <span data-v-4e0ced49> | </span> <a href="https://github.com/meteorlxy/vuepress-theme-meteorlxy" target="_blank" data-v-4e0ced49>
        meteorlxy
      </a></p> <p style="display: block" data-v-4e0ced49>
    备案号: <a href="http://www.beian.miit.gov.cn" target="_blank" data-v-4e0ced49>京ICP备16040058号-1</a></p> <!----></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/vendor.vue.a0164783.js" defer></script><script src="/assets/js/5.6db3e396.js" defer></script><script src="/assets/js/31.611a8ff3.js" defer></script><script src="/assets/js/vendor.commons.d777db81.js" defer></script><script src="/assets/js/app.eba4ba0f.js" defer></script>
  </body>
</html>
